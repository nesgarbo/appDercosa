<ion-header>
  <ion-toolbar>
    <ion-buttons slot="end">
      <ion-button (click)="close()"> {{ "CLOSE" | translate }} </ion-button>
    </ion-buttons>
    <ion-title>{{
      (item?.test.name | uppercase) || "Nuevo tipo de test"
    }}</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content class="ion-padding">
  <form [formGroup]="detailsForm">
    <ion-list style="width: 100%">
      <ion-item>
        <ion-label>Test</ion-label>
        <app-searchable-select
          class="ion-text-right"
          [items]="testOptions()"
          itemValueField="id"
          itemTextField="name"
          formControlName="testId"
          [getItem]="getTest"
          (onSearch)="searchTests($event)"
          (onChange)="onTestChange($event)"
          [canAddItem]="false"
        >
          <ng-template
            #itemTemplate
            let-item
            let-isConsignaSelected="isItemSelected"
          >
            <div style="display: flex; flex-direction: column; margin: 3vw">
              {{ item.name }}
            </div>
          </ng-template>
        </app-searchable-select>
      </ion-item>
      <ion-item>
        <ion-label>Cliente</ion-label>
        <app-searchable-select
          class="ion-text-right"
          [items]="clientOptions()"
          itemValueField="id"
          itemTextField="NOMBRECLI"
          formControlName="clientId"
          [getItem]="getClient"
          (onSearch)="searchClients($event)"
          [canAddItem]="false"
          (onClose)="onClose($event)"
        >
          <ng-template
            #itemTemplate
            let-item
            let-isConsignaSelected="isItemSelected"
          >
            <div style="display: flex; flex-direction: column; margin: 3vw">
              {{ item.NOMBRECLI }}
            </div>
          </ng-template>
        </app-searchable-select>
      </ion-item>
      <ion-item>
        <ion-label style="min-width: 50vw;">Unidad de medida</ion-label>
        <app-searchable-select
          class="ion-text-right"
          [items]="measurementUnitOptions()"
          itemValueField="id"
          itemTextField="name"
          formControlName="measurementUnitId"
          [getItem]="getMeasurementUnit"
          (onSearch)="searchMeasurementUnit($event)"
          [canAddItem]="false"
        >
          <ng-template
            #itemTemplate
            let-item
            let-isConsignaSelected="isItemSelected"
          >
            <div style="display: flex; flex-direction: column; margin: 3vw">
              {{ item.name }}
            </div>
          </ng-template>
        </app-searchable-select>
      </ion-item>
      <ion-item>
        <ion-input
          class="ion-text-right"
          label="Minimo por defecto"
          formControlName="clientMin"
          type="number"
        ></ion-input>
      </ion-item>
      <ion-item>
        <ion-input
          class="ion-text-right"
          label="Maximo por defecto"
          formControlName="clientMax"
          type="number"
        ></ion-input>
      </ion-item>
    </ion-list>
  </form>
</ion-content>
<ion-footer style="padding: 1rem 2rem">
  <ion-button expand="block" (click)="save()" [disabled]="!detailsForm.valid">{{
    this.operation === "edit" ? "Guardar" : "Crear"
  }}</ion-button>
</ion-footer>
